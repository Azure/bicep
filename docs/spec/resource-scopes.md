# Resource Scopes
> **Note:** Not implemented yet.

## Introduction / Motivation
A deployment in ARM has an associated scope, which dictates the scope that resources within that deployment are created in. There are various ways to deploy resources across multiple scopes today in ARM templates; this spec describes how similar functionality can be achieved in Bicep.

See [here][arm-scopes] for more information on ARM scopes.

## Implicit scope
For every `.bicep` file, we implicitly set the default scope to the deployment's resource group when generating ARM template output. This means that unless otherwise specified, resources declared within that file are assigned to this scope.

## Declaring and using scopes

### Types
`Scope`: Contains information about a given scope. May not be assigned to or from any other type.

### Global Functions
The following methods exist under an object named `scope` in the `az` namespace, and all return items of type `Scope`:

```typescript
scope.tenant() // returns the tenant scope
  
scope.managementGroup(name: string) // returns a named management scope

scope.subscription() // returns the subscription scope for the current deployment
scope.subscription(subscriptionId: string) // returns a named subscription scope

scope.resourceGroup() // returns the resource group scope for the current deployment
scope.resourceGroup(resourceGroupName: string) // returns a named resource group scope for a group in the same subscription
scope.resourceGroup(resourceGroupName: string, subscription: string)  // returns a named resource group scope

scope.extension(resourceId: string) // returns an extension scope for a given resourceId (external resource)
```

#### Examples
```
var subScope = scope.subscription()
var rgScope = scope.resourceGroup('myOtherRg')
var extScope = scope.extension(myExternalResourceId)
```

### Resource 'scope' Property
All items of type `Resource` under the `az` namespace accept an optional property named `scope`, of type `Scope`:
```
resource myNic 'Microsoft.Network/networkInterfaces@2020-01-01 = {
  // use a different resource group scope for this resource
  scope: scope.resourceGroup(myExternalResourceGroup)
}
```

### Resource 'asScope' Function
All items of type `Resource` under the `az` namespace define the following member function:
```typescript
[resource].asScope() // returns a Scope generated by a given resource
```

#### Examples
```
// deploy a resource group to the subscription scope
resource myRg 'Microsoft.Resources/resourceGroups@2020-01-01 = {
  name: 'myRg'
  location: 'West US'
  scope: scope.subscription()
}

// deploy a resource into the newly-created resource group
resource myNic 'Microsoft.Network/networkInterfaces@2020-01-01 = {
  name: 'myNic'
  location: 'West US'
  scope: myRg.asScope()
}

// deploy an extension resource on the network interface
resource extension 'Microsoft.MockExtension/extension@2020-01-01 = {
  name: 'myExtension'
  scope: myNic.asScope()
}
```

## Compatibility with upcoming features

### Defaults
With the introduction of defaults, we expect to be able to use this syntax to modify the implicit deployment scope of the `.bicep` file.

### Type Validation
When type definitions are available for resources, we will use type validation to ensure only supported scope types can be assigned to a given resouces.

### Modules
Each module is expected to declare support for a scope or set of scopes. The syntax for assigning a scope to a module should be consistent with that of assigning it to a resource.

[arm-scopes]: https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/overview#understand-scope