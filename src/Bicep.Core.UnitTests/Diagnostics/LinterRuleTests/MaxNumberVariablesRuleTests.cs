// Copyright (c) Microsoft Corporation.
// Licensed under the MIT License.

using Bicep.Core.Analyzers.Linter.Rules;
using Bicep.Core.UnitTests.Assertions;
using FluentAssertions;
using FluentAssertions.Execution;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using System.Linq;

namespace Bicep.Core.UnitTests.Diagnostics.LinterRuleTests
{
    [TestClass]
    public class MaxNumberVariablesRuleTests : LinterRuleTestsBase
    {
        [TestMethod]
        public void ParameterNameInFormattedMessage()
        {
            var ruleToTest = new MaxNumberVariablesRule();
            ruleToTest.GetMessage(nameof(ruleToTest)).Should().Be("Too many variables. Number of variables is limited to 256.");
        }

        private void CompileAndTest(string text, params string[] unusedParams)
        {
            AssertLinterRuleDiagnostics(MaxNumberVariablesRule.Code, text, onCompileErrors: OnCompileErrors.Ignore,  diags =>
            {
                if (unusedParams.Any())
                {
                    var rule = new MaxNumberVariablesRule();
                    string[] expectedMessages = unusedParams.Select(p => rule.GetMessage(p)).ToArray();
                    diags.Select(e => e.Message).Should().ContainInOrder(expectedMessages);
                }
                else
                {
                    diags.Should().BeEmpty();
                }
            });
        }

        [DataRow(@"
                    var v1 string
                    var v2 string
                    var v3 string
                    var v4 string
                    var v5 string
                    var v6 string
                    var v7 string
                    var v8 string
                    var v9 string
                    var v10 string
                    var v11 string
                    var v12 string
                    var v13 string
                    var v14 string
                    var v15 string
                    var v16 string
                    var v17 string
                    var v18 string
                    var v19 string
                    var v20 string
                    var v21 string
                    var v22 string
                    var v23 string
                    var v24 string
                    var v25 string
                    var v26 string
                    var v27 string
                    var v28 string
                    var v29 string
                    var v30 string
                    var v31 string
                    var v32 string
                    var v33 string
                    var v34 string
                    var v35 string
                    var v36 string
                    var v37 string
                    var v38 string
                    var v39 string
                    var v40 string
                    var v41 string
                    var v42 string
                    var v43 string
                    var v44 string
                    var v45 string
                    var v46 string
                    var v47 string
                    var v48 string
                    var v49 string
                    var v50 string
                    var v51 string
                    var v52 string
                    var v53 string
                    var v54 string
                    var v55 string
                    var v56 string
                    var v57 string
                    var v58 string
                    var v59 string
                    var v60 string
                    var v61 string
                    var v62 string
                    var v63 string
                    var v64 string
                    var v65 string
                    var v66 string
                    var v67 string
                    var v68 string
                    var v69 string
                    var v70 string
                    var v71 string
                    var v72 string
                    var v73 string
                    var v74 string
                    var v75 string
                    var v76 string
                    var v77 string
                    var v78 string
                    var v79 string
                    var v80 string
                    var v81 string
                    var v82 string
                    var v83 string
                    var v84 string
                    var v85 string
                    var v86 string
                    var v87 string
                    var v88 string
                    var v89 string
                    var v90 string
                    var v91 string
                    var v92 string
                    var v93 string
                    var v94 string
                    var v95 string
                    var v96 string
                    var v97 string
                    var v98 string
                    var v99 string
                    var v100 string
                    var v101 string
                    var v102 string
                    var v103 string
                    var v104 string
                    var v105 string
                    var v106 string
                    var v107 string
                    var v108 string
                    var v109 string
                    var v110 string
                    var v111 string
                    var v112 string
                    var v113 string
                    var v114 string
                    var v115 string
                    var v116 string
                    var v117 string
                    var v118 string
                    var v119 string
                    var v120 string
                    var v121 string
                    var v122 string
                    var v123 string
                    var v124 string
                    var v125 string
                    var v126 string
                    var v127 string
                    var v128 string
                    var v129 string
                    var v130 string
                    var v131 string
                    var v132 string
                    var v133 string
                    var v134 string
                    var v135 string
                    var v136 string
                    var v137 string
                    var v138 string
                    var v139 string
                    var v140 string
                    var v141 string
                    var v142 string
                    var v143 string
                    var v144 string
                    var v145 string
                    var v146 string
                    var v147 string
                    var v148 string
                    var v149 string
                    var v150 string
                    var v151 string
                    var v152 string
                    var v153 string
                    var v154 string
                    var v155 string
                    var v156 string
                    var v157 string
                    var v158 string
                    var v159 string
                    var v160 string
                    var v161 string
                    var v162 string
                    var v163 string
                    var v164 string
                    var v165 string
                    var v166 string
                    var v167 string
                    var v168 string
                    var v169 string
                    var v170 string
                    var v171 string
                    var v172 string
                    var v173 string
                    var v174 string
                    var v175 string
                    var v176 string
                    var v177 string
                    var v178 string
                    var v179 string
                    var v180 string
                    var v181 string
                    var v182 string
                    var v183 string
                    var v184 string
                    var v185 string
                    var v186 string
                    var v187 string
                    var v188 string
                    var v189 string
                    var v190 string
                    var v191 string
                    var v192 string
                    var v193 string
                    var v194 string
                    var v195 string
                    var v196 string
                    var v197 string
                    var v198 string
                    var v199 string
                    var v200 string
                    var v201 string
                    var v202 string
                    var v203 string
                    var v204 string
                    var v205 string
                    var v206 string
                    var v207 string
                    var v208 string
                    var v209 string
                    var v210 string
                    var v211 string
                    var v212 string
                    var v213 string
                    var v214 string
                    var v215 string
                    var v216 string
                    var v217 string
                    var v218 string
                    var v219 string
                    var v220 string
                    var v221 string
                    var v222 string
                    var v223 string
                    var v224 string
                    var v225 string
                    var v226 string
                    var v227 string
                    var v228 string
                    var v229 string
                    var v230 string
                    var v231 string
                    var v232 string
                    var v233 string
                    var v234 string
                    var v235 string
                    var v236 string
                    var v237 string
                    var v238 string
                    var v239 string
                    var v240 string
                    var v241 string
                    var v242 string
                    var v243 string
                    var v244 string
                    var v245 string
                    var v246 string
                    var v247 string
                    var v248 string
                    var v249 string
                    var v250 string
                    var v251 string
                    var v252 string
                    var v253 string
                    var v254 string
                    var v255 string
                    var v256 string
        ")]
        [DataRow(@"
            var v1 string
            var v2 string
            var v3 string
            var v4 string
            var v5 string
            var v6 string
            var v7 string
            var v8 string
            var v9 string
            var v10 string
            var v11 string
            var v12 string
            var v13 string
            var v14 string
            var v15 string
            var v16 string
            var v17 string
            var v18 string
            var v19 string
            var v20 string
            var v21 string
            var v22 string
            var v23 string
            var v24 string
            var v25 string
            var v26 string
            var v27 string
            var v28 string
            var v29 string
            var v30 string
            var v31 string
            var v32 string
            var v33 string
            var v34 string
            var v35 string
            var v36 string
            var v37 string
            var v38 string
            var v39 string
            var v40 string
            var v41 string
            var v42 string
            var v43 string
            var v44 string
            var v45 string
            var v46 string
            var v47 string
            var v48 string
            var v49 string
            var v50 string
            var v51 string
            var v52 string
            var v53 string
            var v54 string
            var v55 string
            var v56 string
            var v57 string
            var v58 string
            var v59 string
            var v60 string
            var v61 string
            var v62 string
            var v63 string
            var v64 string
            var v65 string
            var v66 string
            var v67 string
            var v68 string
            var v69 string
            var v70 string
            var v71 string
            var v72 string
            var v73 string
            var v74 string
            var v75 string
            var v76 string
            var v77 string
            var v78 string
            var v79 string
            var v80 string
            var v81 string
            var v82 string
            var v83 string
            var v84 string
            var v85 string
            var v86 string
            var v87 string
            var v88 string
            var v89 string
            var v90 string
            var v91 string
            var v92 string
            var v93 string
            var v94 string
            var v95 string
            var v96 string
            var v97 string
            var v98 string
            var v99 string
            var v100 string
            var v101 string
            var v102 string
            var v103 string
            var v104 string
            var v105 string
            var v106 string
            var v107 string
            var v108 string
            var v109 string
            var v110 string
            var v111 string
            var v112 string
            var v113 string
            var v114 string
            var v115 string
            var v116 string
            var v117 string
            var v118 string
            var v119 string
            var v120 string
            var v121 string
            var v122 string
            var v123 string
            var v124 string
            var v125 string
            var v126 string
            var v127 string
            var v128 string
            var v129 string
            var v130 string
            var v131 string
            var v132 string
            var v133 string
            var v134 string
            var v135 string
            var v136 string
            var v137 string
            var v138 string
            var v139 string
            var v140 string
            var v141 string
            var v142 string
            var v143 string
            var v144 string
            var v145 string
            var v146 string
            var v147 string
            var v148 string
            var v149 string
            var v150 string
            var v151 string
            var v152 string
            var v153 string
            var v154 string
            var v155 string
            var v156 string
            var v157 string
            var v158 string
            var v159 string
            var v160 string
            var v161 string
            var v162 string
            var v163 string
            var v164 string
            var v165 string
            var v166 string
            var v167 string
            var v168 string
            var v169 string
            var v170 string
            var v171 string
            var v172 string
            var v173 string
            var v174 string
            var v175 string
            var v176 string
            var v177 string
            var v178 string
            var v179 string
            var v180 string
            var v181 string
            var v182 string
            var v183 string
            var v184 string
            var v185 string
            var v186 string
            var v187 string
            var v188 string
            var v189 string
            var v190 string
            var v191 string
            var v192 string
            var v193 string
            var v194 string
            var v195 string
            var v196 string
            var v197 string
            var v198 string
            var v199 string
            var v200 string
            var v201 string
            var v202 string
            var v203 string
            var v204 string
            var v205 string
            var v206 string
            var v207 string
            var v208 string
            var v209 string
            var v210 string
            var v211 string
            var v212 string
            var v213 string
            var v214 string
            var v215 string
            var v216 string
            var v217 string
            var v218 string
            var v219 string
            var v220 string
            var v221 string
            var v222 string
            var v223 string
            var v224 string
            var v225 string
            var v226 string
            var v227 string
            var v228 string
            var v229 string
            var v230 string
            var v231 string
            var v232 string
            var v233 string
            var v234 string
            var v235 string
            var v236 string
            var v237 string
            var v238 string
            var v239 string
            var v240 string
            var v241 string
            var v242 string
            var v243 string
            var v244 string
            var v245 string
            var v246 string
            var v247 string
            var v248 string
            var v249 string
            var v250 string
            var v251 string
            var v252 string
            var v253 string
            var v254 string
            var v255 string
            var v256 string
            var v257 string
            ",
            "v1","v2","v3","v4","v5","v6","v7","v8","v9","v10","v11","v12","v13","v14","v15","v16","v17","v18","v19","v20","v21","v22","v23","v24","v25","v26","v27","v28","v29","v30","v31","v32","v33","v34","v35","v36","v37","v38","v39","v40","v41","v42","v43","v44","v45","v46","v47","v48","v49","v50","v51","v52","v53","v54","v55","v56","v57","v58","v59","v60","v61","v62","v63","v64","v65","v66","v67","v68","v69","v70","v71","v72","v73","v74","v75","v76","v77","v78","v79","v80","v81","v82","v83","v84","v85","v86","v87","v88","v89","v90","v91","v92","v93","v94","v95","v96","v97","v98","v99","v100","v101","v102","v103","v104","v105","v106","v107","v108","v109","v110","v111","v112","v113","v114","v115","v116","v117","v118","v119","v120","v121","v122","v123","v124","v125","v126","v127","v128","v129","v130","v131","v132","v133","v134","v135","v136","v137","v138","v139","v140","v141","v142","v143","v144","v145","v146","v147","v148","v149","v150","v151","v152","v153","v154","v155","v156","v157","v158","v159","v160","v161","v162","v163","v164","v165","v166","v167","v168","v169","v170","v171","v172","v173","v174","v175","v176","v177","v178","v179","v180","v181","v182","v183","v184","v185","v186","v187","v188","v189","v190","v191","v192","v193","v194","v195","v196","v197","v198","v199","v200","v201","v202","v203","v204","v205","v206","v207","v208","v209","v210","v211","v212","v213","v214","v215","v216","v217","v218","v219","v220","v221","v222","v223","v224","v225","v226","v227","v228","v229","v230","v231","v232","v233","v234","v235","v236","v237","v238","v239","v240","v241","v242","v243","v244","v245","v246","v247","v248","v249","v250","v251","v252","v253","v254","v255","v256","v257")]
        [DataTestMethod]
        public void TestRule(string text, params string[] unusedParams)
        {
            CompileAndTest(text, unusedParams);
        }
    }
}
